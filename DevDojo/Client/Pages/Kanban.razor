@page "/kanban"
@using System.Net.Http
@using System.Net.Http.Json
@using DevDojo.Shared
@using Microsoft.JSInterop
@inject HttpClient http
@inject IJSRuntime js
<style>

    .wrapper {
        width: 100%;
        height: 100vh;
        background: #d7d7d7;
        display: flex;
    }

    .categories {
        width: 100%;
        height: 80%;
        display: flex;
        justify-content: space-evenly;
        align-items: center;
    }

    .cards {
        width: 20%;
        height: 500px;
        background: #ffffff;
        text-align: center;
        display: flex;
        flex-direction: column;
        align-items: center;
        overflow: auto;
        border-radius: 10px;
    }

    .items {
        height: 10%;
        min-height: 50px;
        width: 90%;
        border: solid 1px;
        border-radius: 10px;
        margin-bottom: 15px;
        display: flex;
        justify-content: space-between;
    }

    .cardHead {
        height: 20%;
        width: 90%;
        text-align: center;
        font-size: 2em;
        margin-bottom: 20px;
    }
    .delete{
        cursor: pointer;
    }
</style>

<h3>Kanban</h3>
@if (Items != null)
{
    <div class="wrapper">

        <div class="categories">

            <div class="cards">
                <div class="cardHead">
                    Backlog
                </div>
                @foreach (var item in Items.Where(a => a.Status.Contains("Backlog")))
                {
                    <div class="items">
                        <span>@item.Name</span><span class="delete" @onclick="() => DeleteTask(item)">delete</span>
                    </div>
                }
            </div>


            <div class="cards">
                <div class="cardHead">
                    To do
                </div>
                @foreach (var item in Items.Where(a => a.Status.Contains("Todo")))
                {
                    <div class="items">
                        <span>@item.Name</span><span class="delete" @onclick="() => DeleteTask(item)">delete</span>
                    </div>
                }
            </div>

            <div class="cards">
                <div class="cardHead">
                    Doing
                </div>
                @foreach (var item in Items.Where(a => a.Status.Contains("Doing")))
                {
                    <div class="items">
                        <span>@item.Name</span><span class="delete" @onclick="() => DeleteTask(item)">delete</span>
                    </div>
                }
            </div>

            <div class="cards">
                <div class="cardHead">
                    Done
                </div>
                @foreach (var item in Items.Where(a => a.Status.Contains("Done")))
                {
                    <div class="items">
                        <span>@item.Name</span><span class="delete btn btn-danger" @onclick="() => DeleteTask(item)">delete</span>
                    </div>
                }
            </div>

        </div>

    </div>
}

@code {

    private List<TaskItem> Items;
    private List<TaskItem> tempList;
    protected override async Task OnInitializedAsync()
    {
        Items = await http.GetFromJsonAsync<List<TaskItem>>("api/Items");
        tempList = Items;
    }

    private async Task DeleteTask(TaskItem item)
    {
        //Remove from list
        int index = tempList.IndexOf(item);
        tempList.RemoveAt(index);
        Items = tempList;
        await http.DeleteAsync($"api/Items/{item.Id}");
        Items = (await http.GetFromJsonAsync<List<TaskItem>>("api/Items")).ToList();
        Console.WriteLine("Deleting Item");
        //Remove from database
        //Alert User task has been removed from db
        await js.InvokeVoidAsync("alert", $"{item.Name} Is Gone");
    }

}